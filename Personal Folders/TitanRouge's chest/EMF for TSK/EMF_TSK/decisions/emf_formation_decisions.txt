# -*- ck2.decisions -*-
# Audax Validator EnableCommentMetadata

decisions = {
	emf_create_custom_kingdom = {
		is_high_prio = yes
		only_independent = yes
		ai_check_interval = 60
		
		potential = {
			independent = yes
			real_tier = DUKE
			is_nomadic = no
			holy_order = no
			NOT = { has_game_rule = { name = dynamic_realms value = off } }
			OR = {
				ai = no
				AND = {
					has_game_rule = { name = dynamic_realms value = on }
					OR = {
						prestige > 15000
						AND = {
							prestige > 5000
							emf_has_interesting_trait_for_founding_realm = yes
						}
						AND = {
							trigger_if = {
								limit = { has_global_flag = SWMH }
								OR = {
									realm_size >= 70
									num_of_count_titles_in_realm >= 23
								}
							}
							trigger_else = {
								OR = {
									realm_size >= 50
									num_of_count_titles_in_realm >= 17
								}
							}
							num_of_duke_titles >= 4
						}
					}
				}
			}
			emf_hiprio_decision_basic_potential = yes
		}
		allow = {
			war = no
			is_adult = yes
			prisoner = no
			has_regent = no
			is_incapable = no
			prestige >= 1000
			custom_tooltip = {
				text = NEEDS_800_GOLD_COST
				wealth >= 800
			}
			OR = {
				realm_size >= 35
				num_of_count_titles_in_realm >= 12
			}
			num_of_duke_titles >= 3
		}
		effect = {
			wealth = -800
			primary_title = {
				save_event_target_as = emf_old_title
				create_title = {
					tier = KING
					landless = no
					temporary = no
					custom_created = yes
					culture = ROOT
					holder = ROOT
					base_title = THIS
					copy_title_laws = yes
				}
				ROOT = {
					primary_title = { save_event_target_as = emf_new_title }
				}
			}
			chronicle = {
				entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
				portrait = [Root.GetID]
			}
			hidden_effect = {
				event_target:emf_new_title = { set_flag = emf_custom_created }
				event_target:emf_old_title = {
					if = {
						limit = { empire = { always = yes } }
						empire = { event_target:emf_new_title = { de_jure_liege = PREV } }
					}
					else = {
						event_target:emf_new_title = { de_jure_liege = e_null }
					}
				}
			}
			if = {
				limit = { NOT = { has_global_flag = emf_config_dejure_custom_kingdom_titles } }
				break = yes
			}
			# MAYBE-TODO: Add de jure vassal duchies in a way that ensures they're all contiguous
			any_title_under = {
				limit = {
					tier = DUKE
					is_de_jure_title = yes
					NOT = { kingdom = { has_holder = yes } }
					emf_ROOT_completely_controls_counties = yes
				}
				de_jure_liege = event_target:emf_new_title
			}
			any_title_under = {
				limit = {
					tier = COUNT
					location = {
						duchy = {
							NOT = { kingdom = { has_holder = yes } }
							NOT = { de_jure_liege = event_target:emf_new_title }
							emf_ROOT_completely_controls_counties = yes
						}
					}
				}
				location = {
					duchy = {
						de_jure_liege = event_target:emf_new_title
					}
				}
			}
		}
		ai_will_do = {
			factor = 10
		}
	}

	emf_create_custom_empire = {
		only_independent = yes
		is_high_prio = yes
		ai_check_interval = 60
		
		potential = {
			independent = yes
			tier = KING
			is_nomadic = no
			holy_order = no
			NOT = { has_game_rule = { name = dynamic_realms value = off } }
			OR = {
				ai = no
				has_dejure_empires = no
				AND = { # special AI case for *AI Allowed* (on) setting of *Custom Title Formation* game rule
					has_game_rule = { name = dynamic_realms value = on }
					# Not if it's possible they could restore the HRE from 867 start
					NOT = {
						any_demesne_title = {
							count = 2
						}
					}
					OR = {
						prestige > 36000
						AND = {
							prestige > 12000
							emf_has_interesting_trait_for_founding_realm = yes
						}
						AND = {
							trigger_if = {
								limit = { has_global_flag = SWMH }
								OR = {
									realm_size >= 210
									num_of_count_titles_in_realm >= 70
								}
							}
							trigger_else = {
								OR = {
									realm_size >= 150
									num_of_count_titles_in_realm >= 50
								}
							}
							num_of_king_titles >= 4
						}
					}
				}
			}
			emf_hiprio_decision_basic_potential = yes
		}
		allow = {
			war = no
			is_adult = yes
			prisoner = no
			is_incapable = no
			has_regent = no
			trigger_if = {
				limit = { has_dejure_empires = no }
				prestige >= 1000
				custom_tooltip = {
					text = NEEDS_300_GOLD_COST
					wealth >= 300
				}
			}
			trigger_else = {
				prestige >= 4000
				custom_tooltip = {
					text = NEEDS_1200_GOLD_COST
					wealth >= 1200
				}
			}
			realm_size >= 120
			num_of_king_titles >= 3
		}
		effect = {
			if = {
				limit = { has_dejure_empires = no }
				wealth = -300
			}
			else = {
				wealth = -1200
			}
			primary_title = {
				save_event_target_as = emf_old_title
				create_title = {
					tier = EMPEROR
					landless = no
					temporary = no
					custom_created = yes
					culture = ROOT
					holder = ROOT
					base_title = THIS
					copy_title_laws = yes
				}
				ROOT = {
					primary_title = { save_event_target_as = emf_new_title }
				}
			}
			chronicle = {
				entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
				portrait = [Root.GetID]
			}
			hidden_effect = {
				event_target:emf_new_title = { set_flag = emf_custom_created }
				if = {
					limit = {
						NOR = {
							has_dejure_empires = no
							has_global_flag = emf_config_dejure_custom_empire_titles
						}
					}
					break = yes
				}
				any_title_under = {
					limit = {
						tier = KING
						is_de_jure_title = yes
						OR = {
							NOT = { empire = { has_holder = yes } }
							has_dejure_empires = no
						}
						emf_ROOT_completely_controls_counties = yes
					}
					de_jure_liege = event_target:emf_new_title
				}
				any_title_under = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								OR = {
									NOT = { empire = { has_holder = yes } }
									has_dejure_empires = no
								}
								NOT = { de_jure_liege = event_target:emf_new_title }
								emf_ROOT_completely_controls_counties = yes
							}
						}
					}
					location = {
						kingdom = {
							de_jure_liege = event_target:emf_new_title
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 10
		}
	}
}
