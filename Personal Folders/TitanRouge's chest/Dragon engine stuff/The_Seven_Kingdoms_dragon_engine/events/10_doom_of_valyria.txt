namespace = the_doom

#Targaryen setup
narrative_event = {
    id = the_doom.0
	desc = EVTDESCthe_doom0
	picture = GFX_evt_targaryen
    
    is_triggered_only = yes
	
	hide_window = yes
	
	immediate = {
		if = {
			limit = { independent = no }
			top_liege = {
				save_event_target_as = owner_dragonstone
			}
		}
		else = {
			save_event_target_as = owner_dragonstone
		}
		create_character = {
			random_traits = no
			name = "Aenar"
			dynasty = 1634
			culture = high_valyrian
			religion = valyrian
			female = no
			age = 44
			dna = mmlzfphkxscgmahqcfaru
			attributes = {
				martial = 6
				diplomacy = 8
				stewardship = 9
				intrigue = 12
				learning = 12
			}
			health = 6
			fertility = 0.8
			trait = fortune_builder
			trait = shrewd
			trait = zealous
			trait = lustful
			trait = kind
			trait = dragon_rider
		}
		new_character = {
			give_nickname = nick_the_exile
			save_event_target_as = aenar
			add_pressed_claim = d_dragonstone
			#Some start troops for Aenar
			spawn_unit = {
				owner = event_target:aenar
				province = 797
				home = 797
				troops = {
					archers = { 250 500 }
					light_infantry = { 1000 2000 }
					heavy_infantry = { 1500 3000 }
					light_cavalry = { 250 500 }
				}
				attrition = 1.0
				#disband_on_peace = yes
				maintenance_multiplier = 0
			}
			ROOT = { character_event = { id = the_doom.1 } }
		}
		create_character = {
			random_traits = no
			name = "Jaehaera"
			dynasty = none
			culture = high_valyrian
			religion = valyrian
			female = yes
			age = 36
			dna = kndminkfjbk
			attributes = {
				martial = 6
				diplomacy = 8
				stewardship = 9
				intrigue = 12
				learning = 12
			}
			health = 6
			fertility = 0.8
			trait = grey_eminence
			trait = patient
			trait = zealous
			trait = scholar
			trait = trusting
			trait = temperate
		}
		new_character = {
			save_event_target_as = jaehaera
			add_spouse = event_target:aenar
		}
		create_character = {
			random_traits = no
			name = "Gaemon"
			dynasty = 1634
			culture = high_valyrian
			religion = valyrian
			female = no
			age = 18
			dna = sptgomfasoxttudfdjtpy
			attributes = {
				martial = 6
				diplomacy = 8
				stewardship = 9
				intrigue = 12
				learning = 12
			}
			health = 6
			fertility = 0.8
			trait = skilled_tactician
			trait = patient
			trait = cynical
			trait = dueling_expert
			trait = diligent
		}
		new_character = {
			set_father = event_target:aenar
			set_mother = event_target:jaehaera
			save_event_target_as = gaemon
		}
		create_character = {
			random_traits = no
			name = "Daenys"
			dynasty = 1634
			culture = high_valyrian
			religion = valyrian
			female = yes
			age = 16
			dna = cjggcvgcaaxpzwxttjzcx
			attributes = {
				martial = 6
				diplomacy = 8
				stewardship = 9
				intrigue = 12
				learning = 12
			}
			health = 6
			fertility = 0.8
			trait = midas_touched
			trait = patient
			trait = brave
			trait = mystic
			trait = fertile
			trait = temperate
		}
		new_character = {
			give_nickname = nick_the_dreamer
			set_father = event_target:aenar
			set_mother = event_target:jaehaera
			add_spouse = event_target:gaemon
		}
		create_character = {
			random_traits = no
			name = "Visenyx"
			dynasty = none
			culture = dragon_culture
			religion = dragon_religion
			age = 76
			attributes = {
				martial = 76
			}
			health = 5
			trait = dragon_base_trait
			trait = dragon_trait
			trait = dr_proud
			trait = dr_wroth
			trait = dragon13
		}
		new_character = {
			save_event_target_as = visenyx
			add_friend = event_target:aenar
			add_artifact = black_dragon_egg
			new_artifact = {
				set_name = "Visenyx' egg"
				set_artifact_original_owner = PREV
				transfer_artifact = { from = PREVPREV to = event_target:aenar }
			}
		}
		create_character = {
			random_traits = no
			name = "Callax"
			dynasty = none
			culture = dragon_culture
			religion = dragon_religion
			age = 30
			attributes = {
				martial = 30
			}
			health = 6
			trait = dragon_base_trait
			trait = dragon_trait
			trait = dr_proud
			trait = dr_wroth
			trait = dragon8
		}
		new_character = {
			save_event_target_as = callax
			add_friend = event_target:gaemon
			add_artifact = red_dragon_egg
			new_artifact = {
				set_name = "Callax' egg"
				set_artifact_original_owner = PREV
				transfer_artifact = { from = PREVPREV to = event_target:gaemon }
			}
		}
	}
	
	option = { }
}

# Aenar arrives
character_event = {
    id = the_doom.1
	desc = EVTDESCthe_doom1
	picture = GFX_evt_targaryen
    
    is_triggered_only = yes
	
	major = yes
    
	major_trigger = {
		capital_scope = {
			OR = {
				location = { region = world_westeros_north_south }
				location = { region = world_essos }
			}
		}
	}
	
	immediate = {
		set_global_flag = aenar_arrived
	}
	
	#Owner yields to Aenar
	option = {
		name = EVTOPTAthe_doom1
		
		if = {
			limit = { has_landed_title = c_dragonstone }
			custom_tooltip = {
				text = EVTthe_doom1CUSTOM
				event_target:aenar = {
					c_dragonstone = { gain_title = PREV }
					d_dragonstone = { gain_title = PREV }
				}
			}
			hidden_tooltip = {
				if = {
					limit = { k_dragonstone = { is_title_active = yes } }
					k_dragonstone = { destroy_landed_title = THIS }
				}
				event_target:visenyx = {
					move_character = event_target:aenar
				}
				event_target:callax = {
					move_character = event_target:aenar
				}
			}
		}
	}
	
	#Owner rejects
	option = {
		name = EVTOPTBthe_doom1
		
		if = {
			limit = { has_landed_title = c_dragonstone }
			event_target:aenar = {
				c_dragonstone = { gain_title = PREV }
				any_demesne_title = {
					limit = { is_landless_type_title = yes }
					destroy_landed_title = THIS
				}
			}
			reverse_unsafe_war = {
				target = event_target:aenar
				casus_belli = duchy_adventure
			}
		}
	}
}

# The Doom
narrative_event = {
    id = the_doom.2
	desc = EVTDESCthe_doom2
	picture = GFX_evt_targaryen
    
    #is_triggered_only = yes
	
	trigger = {
		has_landed_title = c_dragonstone
		had_global_flag = { flag = aenar_arrived days = 4 }
	}
	
	major = yes
    
	major_trigger = {
		capital_scope = {
			OR = {
				location = { region = world_westeros_north_south }
				location = { region = world_essos }
			}
		}
	}
	immediate = {
		set_global_flag = the_doom_of_valyria
	}
	
	option = {
		name = EVTOPTAthe_doom2
	}
}