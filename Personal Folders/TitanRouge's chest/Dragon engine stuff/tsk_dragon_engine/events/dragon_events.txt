namespace = dragon

#	Initialize 
character_event = {
	id = dragon.0

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_dragon = yes
	}
	
	immediate = {
		# Dragon stat Calculation
		dragon_stat_calculation = yes
		repeat_event = { id = dragon.0 days = 31 }
		character_event = { id = dragon.1 days = 1 }
	}
}

#	Sets dragon status
character_event = {
	id = dragon.1

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_dragon = yes
	}
	
	immediate = {
		if = {
			limit = { 
				any_friend = { is_dragon_rider = yes }
			}
			set_character_flag = is_tamed_dragon
		}
		if = {
			limit = { 
				any_friend = { is_dragon_rider = no }
			}
			set_character_flag = is_wild_dragon
		}
	}
}

#	Simulates the dragons growth
character_event = {
	id = dragon.2

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_dragon = yes
	}
	
	immediate = {
		change_martial = 1
		random = {
			chance = 25
			modifier = {
				factor = 2
				trait = dragon_strong
			}
			change_martial = 1
		}
	}
}

#kills the dragon
character_event = {
	id = dragon.3

	#is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_dragon = yes
		age = 110
	}
	
	mean_time_to_happen = { days = 1 }
	
	immediate = {
		random = {
			chance = 30
			modifier = {
				factor = 0
				age < 110
			}
			modifier = {
				factor = 1.2
				age <= 120
				NOT = { age <= 110 }
			}
			modifier = {
				factor = 1.4
				age <= 130
				NOT = { age <= 120 }
			}
			modifier = {
				factor = 1.6
				age <= 140
				NOT = { age <= 130 }
			}
			modifier = {
				factor = 1.8
				age <= 150
				NOT = { age <= 140 }
			}
			modifier = {
				factor = 2.2
				age <= 160
				NOT = { age <= 150 }
			}
			death = { death_reason = death_natural } 
		}
	}
}

#spawns dragon eggs
#character_event = {
#	id = dragon.4

#	is_triggered_only = yes
#	hide_window = yes
#}

#use dragon battle
character_event = {
	id = dragon.5
	desc = EVTDESCdragon5
	picture = GFX_evt_Battle_Dragon
	#border = GFX_event_normal_frame_martial

	is_triggered_only = yes
	
	trigger = {
		use_dragon_in_battle_potential = yes
	}
	
	immediate = {
		ROOT = {
			any_friend = {
				limit = { is_tamed_dragon = yes }
				save_event_target_as = your_dragon
			}
		}
	}
	
	option = {	#Burn them all!
		name = EVTOPTAdragon5
		
		any_current_enemy =  {
			any_realm_character = {
				limit = {
					in_command = yes
					prisoner = no
					NOT = { character = ROOT }
					is_dragon_rider = no
					at_location = ROOT
					#has_siege = no
				}
				opinion = { modifier = used_dragon_against_me who = ROOT years = 6 }
				troop_damage_by_dragon = yes
				character_event = { id = dragon.7 }
			}
		}
	}
}

#Use dragon siege
character_event = {
	id = dragon.6
	desc = EVTDESCdragon6
	picture = GFX_evt_battle_dragon_two
	#border = GFX_event_normal_frame_martial

	is_triggered_only = yes

	trigger = {
		use_dragon_in_siege_potential = yes
	}
	
	immediate = {
		ROOT = {
			any_friend = {
				limit = { is_tamed_dragon = yes }
				save_event_target_as = your_dragon
			}
		}
	}
	
	option = { #Let these stones be their graves
		name = EVTOPTAdragon6
		
		ROOT = {
			any_friend = {
				#limit = { is_tamed_dragon = yes }
				random = {
					chance = 20
					
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 20 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 25 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 30 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 35 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 40 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 45 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 50 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 55 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 60 } 
					}
					modifier = {
						factor = 0.9
						check_variable = { which = drastrvar value <= 65 } 
					}
				}
			}
		}	
		
		siege =  {
			enemy = {
				limit = {
					hidden_tooltip = {
						in_command = yes
						battle = no
						#is_defender = yes
						prisoner = no
						NOT = { character = ROOT }
						is_dragon_rider = no
						at_location = ROOT
					}
				}
				opinion = { modifier = used_dragon_against_me who = ROOT years = 6 }
				troop_damage_by_dragon = yes
				character_event = { id = dragon.7 }
			}
		}
	}
}

#	Enemy gets wounded or dies in battle/siege
character_event = {
	id = dragon.7
	desc = EVTDESCdragon7
	picture = GFX_evt_battle_dragon_two
	#border = GFX_event_normal_frame_martial

	is_triggered_only = yes
	
	trigger = {
		at_location = FROM
	}
	
	option = {
		name = EVTOPTAdragon9
		random_list = {
			30 = {
				death = { death_reason = death_dragon_fire1 killer = event_target:your_dragon }
			}
			15 = {
				add_trait = maimed
			}
			15 = {
				add_trait = severely_injured
			}
			30 = {	
				add_trait = wounded
			}
			10 = {
			
			}
		}
	}
}

#	Face the dragon
character_event = {
	id = dragon.8
	desc = EVTDESCdragon8
	picture = GFX_evt_battle_dragon_two
	#border = GFX_event_normal_frame_martial

	is_triggered_only = yes
	
	option = {
		name = EVTOPTAdragon8
		random_list = {
			50 = {
				# increased taming chance
				modifier = {
				factor = 1.5
				event_target:targetted_dragon_for_taming = { trait = dragon_wounded }
				}
				modifier = {
					factor = 2.1
					event_target:targetted_dragon_for_taming = { trait = dragon_maimed }
				}
				modifier = {
					factor = 1.2
					event_target:targetted_dragon_for_taming = { trait = dragon_slothful }
				}
				modifier = {
					factor = 2.5
					event_target:targetted_dragon_for_taming = { trait = dragon_humble }
				}
				modifier = {
					factor = 3
					event_target:targetted_dragon_for_taming = { trait = dragon_friendly }
				}
				#decreased
				modifier = {
					factor = 0.6
					event_target:targetted_dragon_for_taming = { trait = dragon_wroth }
				}
				modifier = {
					factor = 0.8
					event_target:targetted_dragon_for_taming = { trait = dragon_proud }
				}
				modifier = {
					factor = 0.4
					NOT = { culture_group = valyrian }
				}
				modifier = {
					factor = 5
					culture_group = valyrian
				}
				custom_tooltip = {
					text = TOOLTIP_DRAGON8_A
					event_target:targetted_dragon_for_taming = {
						add_friend = ROOT
					}
					#character_event = { id = dragon.9 }
				}
			}
			50 = {
				custom_tooltip = {
					text = TOOLTIP_DRAGON8_B
					death = { death_reason = death_dragon_fire2 killer = event_target:targetted_dragon_for_taming }
				}
			}
		}
	}
}

#	Taming successful!
character_event = {
	id = dragon.9
	desc = EVTDESCdragon9
	picture = GFX_evt_battle_dragon_two
	#border = GFX_event_normal_frame_martial

	is_triggered_only = yes
	
	option = {
		name = EVTOPTAdragon9

	}
}

#	Taming failed!
character_event = {
	id = dragon.10
	desc = EVTDESCdragon10
	picture = GFX_evt_battle_dragon_two
	#border = GFX_event_normal_frame_martial

	is_triggered_only = yes
	
	option = {
		name = EVTOPTAdragon10
	}
}