namespace = nights_watch

# These events are dedicated to the Black Brothers.
# It will move any under thirteen characters out of the NW

# Lord Commander and vassals Cleanup
# This fires for the Lord Commander and their vassals on a regular basis if they are married or lacking our trait

# Insignificant impact, fired on new holder and twice a year.
character_event = {
    id = nights_watch.1
    
    hide_window = yes
    is_triggered_only = yes
    
    # This should prevent it from firing for our barons
    only_playable = yes
    
    trigger = {
        OR = {
            is_married = yes
            NOT = {
                trait = black_brother
            }
        }
        OR = {
            primary_title = {
                OR = {
                    title = d_the_wall
                    title = k_the_nights_watch
                }
            }
            any_liege = {
                primary_title = {
                    OR = {
                        title = d_the_wall
                        title = k_the_nights_watch
                    }
                }
            }
        }
    }
    
    immediate = {
        if = {
            limit = {
                NOT = {
                    trait = black_brother
                }
            }
            add_trait = black_brother
        }
        if = {
            limit = {
                is_married = yes
            }
            remove_spouse = spouse
        }
    }
}

# Court cleanup
# Sends females and children away to relatives, or if lacking, other realms.
# Split off into second event, so it can be fired less frequently
# Plus, I think the original event was broken.

# Slightly harsher impact than the first event, but fired yearly
character_event = {
    id = nights_watch.2
    
    hide_window = yes
    is_triggered_only = yes
    
    trigger = {
        liege = {
            trait = black_brother
        }
        NOT = {
            trait = black_brother
        }
        is_ruler = no
    }
    
    immediate = {
        if = {
            limit = {
                spouse = {
                    trait = black_brother
                }
                remove_spouse = spouse
            }
        }
        if = {
            limit = {
                age = 13
                is_female = no
            }
            add_trait = black_brother
            break = yes
        }
        if = {
			limit = {
				OR = {
					is_female = yes
					NOT = {
						age = 13
					}
				}
			}
            father = {
                if = {
                    limit = {
                        is_alive = yes
                    }
                    if = {
                        limit = {
                            is_ruler = yes
                        }
                        ROOT = {
                            move_character = PREV
                        }
                        break = yes
                    }
                    if = {
                        limit = {
                            NOT = {
                                is_ruler = yes
                                ROOT = {
                                    mother = {
                                        is_alive = yes
                                        is_ruler = yes
                                    }
                                }
                            }
                        }
                        liege = {
                            ROOT = {
                                move_character = PREV
                            }
                        }
                        break = yes
                    }
                }
            }
            mother = {
                if = {
                    limit = {
                        is_alive = yes
                    }
                    if = {
                        limit = {
                            is_ruler = yes
                        }
                        ROOT = {
                            move_character = PREV
                        }
                        break = yes
                    }
                    if = {
                        limit = {
                            NOT = {
                                is_ruler = yes
                            }
                        }
                        liege = {
                            ROOT = {
                                move_character = PREV
                            }
                        }
                        break = yes
                    }
                }
            }
            if = {
                limit = {
                    NOT = {
                        dynasty = NONE
                    }
                }
                if = {
                    limit = {
                        dynasty_head = {
                            NOT = {
                                character = ROOT
                            }
                            is_alive = yes
                            is_ruler = yes
                        }
                    }
                    dynasty_head = {
                        ROOT = {
                            move_character = PREV
                        }
                    }
                    break = yes
                }
                if = {
                    limit = {
                        random_dynasty_member = {
                            is_alive = yes
                            is_ruler = yes
                        }
                    }
                    random_dynasty_member = {
                        ROOT = {
                            move_character = PREV
                        }
                    }
                    break = yes
                }
            }
			random_independent_ruler = {
				limit = {
					NOR = {
						has_landed_title = d_the_wall
						has_landed_title = k_the_nights_watch
					} 
				}
				random_realm_lord = {
					ROOT = {
                        move_character = PREV
                    }
                }
			}
		}
    }
}