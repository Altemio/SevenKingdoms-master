namespace = tsk_swear_fealty

character_event = {
	id = tsk_swear_fealty.1
	desc = EVTDESCTSK_SWR_FEA
    
	is_triggered_only = yes
	only_playable = yes
	
	option = {
		name = EVTOPTATSK_SWR_FEA1 # Form Empire, Accept as Vassal
        
        # FROMFROM is the player who requested to be vassalized by
        # same tier ruler.
        # ROOT is the target, ie the potential liege
		
        # Consider uses nested if statements with limiters
        # to assign premade empire tier titles based on primary held
        # title.
        
        # We could create some complex combinations, based on original title
        # and the title of sender.
        
        # For example, if Arbor sends Oldtown an offer, the Wynelander Kingdom
        # could be formed, using a flag that consists of a mix of both Arbor 
        # and Oldtown flag.
        
        # If Arbor is offering to form a union with Oldtown,
        # The Wynlands can be formed.
        if = {
            limit = {
                FROMFROM = {
                    primary_title = {
                        title = k_the_arbor
                    }
                }
                ROOT = {
                    primary_title = {
                        title = k_oldtown
                    }
                }
            }
            e_the_wynelands = {
                grant_title = ROOT
                make_primary_title = yes
                copy_title_laws = k_oldtown
                copy_title_history = k_oldtown
            }
            
            FROMFROM = {
                holder_scope = { set_defacto_liege = ROOT }
            }
            break = yes
        }
        # Reverse
        if = {
            limit = {
                FROMFROM = {
                    primary_title = {
                        title = k_oldtown
                    }
                }
                ROOT = {
                    primary_title = {
                        title = k_the_arbor
                    }
                }
            }
            e_the_wynelands = {
                grant_title = ROOT
                make_primary_title = yes
                copy_title_laws = k_the_arbor
                copy_title_history = k_the_arbor
            }
            
            FROMFROM = {
                holder_scope = { set_defacto_liege = ROOT }
            }
            break = yes
        }
        
        # Otherwise, form generic CM title based off current primary title.
        
		primary_title = {
            create_title = {
                tier = EMPEROR
                landless = no
                temporary = no
                custom_created = yes
                culture = ROOT
                holder = ROOT
                base_title = THIS
                copy_title_laws = yes
            }

            hidden_tooltip = {
                ROOT = {
                    primary_title = {
                        holder_scope = {
                            any_title_under = {
                                limit = {
                                    tier = KING
                                    empire = {
                                        has_holder = no
                                    }
                                }
                                de_jure_liege = PREVPREV
                            }
                            any_title_under = {
                                limit = {
                                    tier = DUKE
                                    location = {
                                        kingdom = {
                                            empire = {
                                                has_holder = no
                                            }
                                            
                                            NOT = { de_jure_liege_or_above = PREVPREVPREVPREV }
                                            ROOT = {
                                                completely_controls = PREV
                                            }
                                        }
                                    }
                                }
                                location = {
                                    kingdom = {
                                        de_jure_liege = PREVPREVPREVPREV
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        
        FROMFROM = {
            holder_scope = { set_defacto_liege = ROOT }
        }
	}
	
	option = {
		name = EVTOPTATSK_SWR_FEA2 # No
	}
}