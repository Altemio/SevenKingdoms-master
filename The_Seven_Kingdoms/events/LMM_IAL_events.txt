namespace = LMMIAL

character_event = {
	id = LMMIAL.1001
		
	hide_window = yes
	
	only_playable = yes
		
	trigger = {
		age = 16
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {		
		#Check if the character is in command during a war and if yes then apply or remove the modifier.
		LMM_apply_remove_army_leader_modifier_effect = yes
		
		#Check if any close relative or spouse is in command during a war, if yes then apply or remove modifier to that close relative or spouse
		any_close_relative = {
			liege = { character = PREVPREV } #To ensure that the close relative is a vassal/courtier of the ruler
			LMM_apply_remove_army_leader_modifier_effect = yes
		}
		any_spouse = {
			liege = { character = PREVPREV } #To ensure that the spouse is a vassal/courtier of the ruler
			LMM_apply_remove_army_leader_modifier_effect = yes
		}
		
		
		if = {
			#Check if no close relative or spouse is in command during a war when the ruler is a primary attacker or defender
			limit = {
				NOT = { has_character_modifier = LMMIAL_war_cowardice_m }
				OR = {
					is_primary_war_attacker = yes
					is_primary_war_defender = yes
				}
				NOR = {
					in_command = yes
					any_close_relative = {
						in_command = yes
						liege = { character = PREVPREV }												
					}
					any_spouse = {
						in_command = yes
						liege = { character = PREVPREV }						
					}					
				}
				#Make sure that the ruler is male, or if she is female check if she has the highest "status of women" law (conclave)
				OR = {
					is_female = no
					AND = {
						has_dlc = "Zeus" #Conclave
						NOR = {
							has_game_rule = {
								name = gender
								value = historical
							}
							has_game_rule = {
								name = gender
								value = all
							}
							has_law = status_of_women_4					
						}
					}
				}
			}
			add_character_modifier = {
				name = LMMIAL_war_cowardice_m
				duration = -1
			}
			add_trait = LMMIAL_war_cowardice_t		
		}
		else_if = {
			limit = {
				has_character_modifier = LMMIAL_war_cowardice_m
				OR = {
					NOR = {
						is_primary_war_attacker = yes
						is_primary_war_defender = yes
					}
					OR = {
						in_command = yes
						any_close_relative = {
							in_command = yes
							liege = { character = PREVPREV }
						}
						any_spouse = {
							in_command = yes
							liege = { character = PREVPREV }							
						}						
					}
				}
			}
			remove_character_modifier = LMMIAL_war_cowardice_m
			remove_trait = LMMIAL_war_cowardice_t
		}
	}
}
