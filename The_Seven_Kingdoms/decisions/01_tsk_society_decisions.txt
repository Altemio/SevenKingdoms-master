# Request Knighthood, Rank 1 Onwards
# Establish a ward as a page from 10, at 15 let your page become a squire.

society_decisions = {
    request_knighthood = {
        only_playable = yes
        is_high_prio = yes
        
        potential = {
            society_member_of = knighthood_the_seven
            society_rank == 2
            is_playable = yes
            block_general_event_trigger = no
        }
        allow = {
            wealth = 200
            society_currency >= 500
            days_in_society > 730
        }
        effect = {
            # Event for Knighthood
            hidden_tooltip = {
                save_event_target_as = knighthood_target
                set_character_flag = has_sent_request_for_knighthood
                character_event = { id = TSK_S.4 days = 20 random = 10 } # sends hidden delayed event to self, which then sends request to Leader of the society
            }
        }
        revoke_allowed = {
            always = no
        }
        ai_will_do = {
            factor = 1
            
            modifier = {
                factor = 0
                NOT = { wealth = 250 }
            }
            
            modifier = {
                factor = 0.1
                NOT = { age = 26 }
            }
            
            modifier = {
                factor = 10
                age = 40
            }
        }
    }
}

# Allows members of the Seven group to Knight members of their court for 200 prestige a piece.

targetted_decisions = {
    knight_target = {
        ai_target_filter = court
        
        from_potential = {
			ai = no
		}
		potential = {
			is_combat_trained = yes
            religion_group = the_seven_group
		}
		allow = {
			always = yes
            FROM = {
                prestige = 200
            }
		}
        
        effect = {
			# Remove prestige based on their current trait.
            if = {
                limit = {
                    trait = page
                }
                FROM = {
                    prestige = -150
                }
            }
            if = {
                limit = {
                    trait = squire
                }
                FROM = {
                    prestige = -100
                }
            }
            if = {
                limit = {
                    NOR = {
                        trait = page
                        trait = squire
                    }
                }
                FROM = {
                    prestige = -200
                }
            }
            
            # Give them the Knighthood, be it Knight or Hedge (depending on faith)
            if = {
                limit = {
                    FROM = {
                        religion = the_seven
                        trait = knight
                    }
                }
                add_trait = knight
            }
            if = {
                limit = {
                    FROM = {
                        OR = {
                            NOT = {
                                religion = the_seven
                            }
                            trait = hedge_knight
                        }
                    }
                }
                add_trait = hedge_knight
            }
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
    }
}