
# Our first casus belli allows conquest of individual counties from neighbouring equal-tier rulers.
# Our second casus belli allows conquest of duchies from neighbouring equal tier rulers, but at greater cost.

# Currently you can only use the casus belli against other religions, ie seven against old gods.

# ROOT is the attacker
# FROM is the target

tsk_county_conquest = {
    name = CB_NAME_TSK_COUNTY_CONQUEST
    war_name = WAR_NAME_TSK_COUNTY_CONQUEST
    
    sprite = 16
    truce_days = 1825
    hostile_against_others = yes
    is_permanent = yes
    check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
    press_claim = yes
    can_ask_to_join_war = no
    
    allowed_to_target_tributaries = no
    allowed_to_target_suzerains = no
    
    # You require 150 prestige to use
    can_use_gui = {
        ROOT = {
            NOT = {
                trait = content
            }
            prestige = 50
        }
    }
    
    on_add = {
        ROOT = { prestige = -50 }
    }
    
    can_use = {
        ROOT = {
            mercenary = no
            NOT = {
                same_realm = FROM
            }
            OR = {
                primary_title = { higher_tier_than = COUNT } 
                primary_title = { higher_tier_than = DUKE }
            }
        }
    }

    can_use_title = {
        tier = COUNT
        
        NOR = {
            FROM = {
                has_landed_title = k_the_nights_watch
            }
            holder_scope = {
                is_liege_or_above = FROM
                has_landed_title = k_the_nights_watch
            }
        }
        
        # if:
        # Our target is a player (ai = no)
        # the location is the capital (is_capital = yes)
        # then disallow war
        
        NOR = {
            AND = {
                FROM = {
                    ai = no
                }
                location = {
                    is_capital = yes
                }
            }
            ROOT = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = ROOT
            }
        }
        
        # Our target holds the county
        # or they have a vassal that holds it
        
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
                NOT = {
                    same_realm = ROOT
                }
            }
        }

        # Drowned gods may target who they wish
        # so long as the target is coastal
        
        # If it is not a specific title or ironborn,
        # then
        # target province/s must border the target realm
        
        OR = {
            AND = {
                ROOT = {
                    religion_group = drowned_god_group
                    culture_group = iron_islander
                }
                location = {
                    port = yes
                }
            }
            # Some islands literally cannot do anything, so they are being granted the ability to take ports
            # only applicable if it is your primary title.
            AND = {
                ROOT = {
                    OR = {
                        primary_title = {
                            OR = {
                                title = e_the_iron_islands
                                title = k_the_iron_islands
                                title = k_the_shields
                                title = k_evenstar
                                title = k_the_arbor
                                title = k_the_sisters
                                title = k_fair_isle
                                title = k_the_stepstones
                                title = k_andalos
                                title = k_stone
                                title = k_dragonstone
                                title = d_dragonstone
                                title = c_dragonstone
                                title = c_driftmark
                            }
                        }
                        culture = pirate
                    }
                }
                location = {
                    port = yes
                }
            }
            location = {
                any_neighbor_province = {
                    owner = {
                        OR = {
                            character = ROOT
                            is_liege_or_above = ROOT
                        }
                    }
                }
            }
        }
    }

    is_valid_title = {
        ROOT = {
            NOT = {
                same_realm = FROM
            }
        }
    
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
            }
        }
    }

    on_success_title = {
        usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
        
        any_de_jure_vassal_title = { # take all baronies too
            limit = {
                has_holder = yes
                holder_scope = {
                    OR = {
                        character = FROM
                        is_liege_or_above = FROM
                        AND = {
                            is_liege_or_above = ROOT
                            NOT = { culture = ROOT }
                            NOT = { religion = ROOT }
                        }
                    }
                }
            }

            usurp_title = ROOT
        }
    }

    on_fail_title = {
        ROOT = {
            prestige = -200
        }
    
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 50 }
        }
    }

    on_reverse_demand = {
        ROOT = {
            prestige = -200
            transfer_scaled_wealth = {
                to = FROM
                value = 2.0
            }
        }
        
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 100
            participation_scaled_piety = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = {
                participation_scaled_prestige = 100 
                participation_scaled_piety = 50
            }
        }
    }

    attacker_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    defender_ai_defeat_worth = {
        factor = 100
    }
    ai_will_do = { 
        factor = 1
        
        # Intrigue
        modifier = {
            factor = 1.5
            
            trait = elusive_shadow
        }
        modifier = {
            factor = 1.25
            
            trait = intricate_webweaver
        }
        
        # Matrial
        modifier = {
            factor = 2.0
            
            trait = brilliant_strategist
        }
        modifier = {
            factor = 1.5
            
            trait = skilled_tactician
        }
        modifier = {
            factor = 1.25
            
            trait = tough_soldier
        }
        modifier = {
            factor = 1.15
            
            trait = misguided_warrior
        }
        
        # Traits
        modifier = {
            factor = 1.25
            trait = greedy
        }
        
        modifier = {
            factor = 2.00
            trait = ambitious
        }
        modifier = {
            factor = 2.00
            trait = sociopath
        }
        
        # Railroading
        modifier = {
            factor = 0.0
            
            trait = content
            NOR = {
                trait = elusive_shadow
                trait = intricate_webweaver
                trait = brilliant_strategist
                trait = skilled_tactician
                trait = tough_soldier
                trait = misguided_warrior
                trait = ambitious
                trait = sociopath
                trait = greedy
            }
        }
    }
}

# Now subjugates duchies rather than conquers
tsk_duchy_conquest = {
    name = CB_NAME_TSK_DUCHY_CONQUEST
    war_name = WAR_NAME_TSK_DUCHY_CONQUEST
    sprite = 16
    truce_days = 1825
    is_permanent = yes
    
    hostile_against_others = yes
    
    check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
    press_claim = yes
    can_ask_to_join_war = no
    
    allowed_to_target_tributaries = no
    allowed_to_target_suzerains = no
    
    infamy_modifier = 1.5
    
    # You require 600 prestige to use
    can_use_gui = {
        ROOT = {
            NOT = {
                trait = content
            }
            prestige = 500
        }
    }
    
    on_add = {
        ROOT = { prestige = -500 }
    }
    
    can_use = {
        ROOT = {
            mercenary = no
            AND = {
                primary_title = { higher_tier_than = DUKE }
                NOT = {
                    same_realm = FROM
                }
            }
        }
    }

    can_use_title = {
        tier = DUKE
        
        NOR = {
            FROM = {
                has_landed_title = k_the_nights_watch
            }
            holder_scope = {
                is_liege_or_above = FROM
                has_landed_title = k_the_nights_watch
            }
        }
        
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
                NOT = {
                    same_realm = ROOT
                }
            }
        }
        
        any_direct_de_jure_vassal_title = {
            OR = {
                holder_scope = {
                    OR = {
                        character = ROOT
                        is_liege_or_above = ROOT
                    }
                }
                location = {
                    any_neighbor_province = {
                        has_owner = yes
                        owner = {
                            OR = {
                                character = ROOT
                                is_liege_or_above = ROOT
                            }
                        }
                    }
                }
            }
        }
    }

    is_valid_title = {
        ROOT = {
            NOT = {
                same_realm = FROM
            }
        }
    
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
            }
        }
    }

    on_success_title = {
        ROOT = {
            vassalize_or_take_under_title = {
                title = PREV
                enemy = FROM
                # same_religion = yes # Only vassalize rulers of my religion
                type = invasion
            }
        }
    }

    on_fail_title = {
        ROOT = {
            prestige = -200
        }
    
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 50 }
        }
    }

    on_reverse_demand = {
        ROOT = {
            prestige = -200
            transfer_scaled_wealth = {
                to = FROM
                value = 3.0
            }
        }
        
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 100
            participation_scaled_piety = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = {
                participation_scaled_prestige = 100 
                participation_scaled_piety = 50
            }
        }
    }

    attacker_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    defender_ai_defeat_worth = {
        factor = 100
    }
    ai_will_do = { 
        factor = 1
        
        # Intrigue
        modifier = {
            factor = 1.5
            
            trait = elusive_shadow
        }
        modifier = {
            factor = 1.25
            
            trait = intricate_webweaver
        }
        
        # Matrial
        modifier = {
            factor = 2.0
            
            trait = brilliant_strategist
        }
        modifier = {
            factor = 1.5
            
            trait = skilled_tactician
        }
        modifier = {
            factor = 1.25
            
            trait = tough_soldier
        }
        modifier = {
            factor = 1.15
            
            trait = misguided_warrior
        }
        
        # Traits
        modifier = {
            factor = 1.25
            trait = greedy
        }
        
        modifier = {
            factor = 2.00
            trait = ambitious
        }
        modifier = {
            factor = 2.00
            trait = sociopath
        }
        
        # Railroading
        modifier = {
            factor = 0.0
            
            trait = content
            NOR = {
                trait = elusive_shadow
                trait = intricate_webweaver
                trait = brilliant_strategist
                trait = skilled_tactician
                trait = tough_soldier
                trait = misguided_warrior
                trait = ambitious
                trait = sociopath
                trait = greedy
            }
        }
    }
}

tsk_subjugation = {
    name = CB_NAME_TSK_SUBJUGATION
    war_name = WAR_NAME_TSK_SUBJUGATION
    sprite = 8
    truce_days = 365
    hostile_against_others = yes
    is_permanent = yes
    can_ask_to_join_war = yes
    check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
    
    allowed_to_target_tributaries = no
    allowed_to_target_suzerains = no
    
    can_use_gui = {
        OR = {
			ROOT = {
				higher_tier_than = king
			}
			NOT = {
				FROM = {
					tier = emperor
				}
			}
		}
        ROOT = {
            prestige = 1500
            OR = {
                trait = ambitious
                trait = sociopath
                trait = brilliant_strategist
            }
        }
    }
    
    can_use = {
        ROOT = {
            NOT = { same_realm = FROM }
            NOT = { is_liege_or_above = FROM }
            has_horde_culture = no
            is_nomadic = no
            mercenary = no
        }
    }
    
    can_use_title = {
        NOR = {
            FROM = {
                has_landed_title = k_the_nights_watch
            }
            holder_scope = {
                is_liege_or_above = FROM
                has_landed_title = k_the_nights_watch
            }
        }
    }
    
    on_add = {
        ROOT = {
            prestige = -1500
            add_character_modifier = { 
                name = launched_subjugation
                years = 5
                hidden = yes
            }
        }
    }
    
    on_success = {
        any_attacker = {
            limit = { character = ROOT }
            participation_scaled_prestige = 500
        }
        any_attacker = {
            limit = { NOT = { character = ROOT } }
            hidden_tooltip = { participation_scaled_prestige = 500 }
        }
        FROM = {
            prestige = -500
            
            hidden_tooltip = {
                opinion = {
                    modifier = opinion_subjugated 
                    who = ROOT
                }
                any_vassal = {
                    opinion = {
                        modifier = opinion_subjugated 
                        who = ROOT
                    }
                }
                any_demesne_title = {
                    limit = {
                        higher_tier_than = ROOT
                        NOT = { controls_religion = yes }
                    }
                    ROOT = { grant_title_no_opinion = { target = PREV type = invasion } }
                    add_pressed_claim = PREV
                }
                
                any_demesne_title = {
                    limit = {
                        tier = ROOT
                        NOT = { controls_religion = yes }
                    }
                    ROOT = { grant_title_no_opinion = { target = PREV type = invasion } }
                    add_pressed_claim = PREV
                }

                if = {
                    limit = {
                        NOT = {
                            any_demesne_title = {
                                controls_religion = yes
                            }
                        }
                    }
                    set_defacto_liege = ROOT
                    break = yes
                }
                any_vassal = {
                    set_defacto_liege = ROOT
                }
                any_demesne_title = {
                    limit = {
                        NOT = { controls_religion = yes }
                    }
                    ROOT = {
                        grant_title_no_opinion = { target = PREV type = invasion }
                    }
                }
            }
        }
    }

    on_fail = {
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 200
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 200 }
        }
        ROOT = {
            prestige = -250
        }
    }
    
    on_invalidation = {
        ROOT = {
            remove_character_modifier = launched_subjugation
        }
    }

    on_reverse_demand = {
        ROOT = {
            prestige = -500
            transfer_scaled_wealth = {
                to = FROM
                value = 3.0
            }
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 500
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 200 }
        }
    }

    attacker_ai_victory_worth = {
        factor = 200
    }
    
    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    defender_ai_defeat_worth = {
        factor = 100
    }
    
    ai_will_do = { 
        factor = 1
        
        # Intrigue
        modifier = {
            factor = 1.5
            
            trait = elusive_shadow
        }
        modifier = {
            factor = 1.25
            
            trait = intricate_webweaver
        }
        
        # Matrial
        modifier = {
            factor = 2.0
            
            trait = brilliant_strategist
        }
        modifier = {
            factor = 1.5
            
            trait = skilled_tactician
        }
        modifier = {
            factor = 1.25
            
            trait = tough_soldier
        }
        modifier = {
            factor = 1.15
            
            trait = misguided_warrior
        }
        
        # Traits
        modifier = {
            factor = 1.25
            trait = greedy
        }
        
        modifier = {
            factor = 2.00
            trait = ambitious
        }
        modifier = {
            factor = 2.00
            trait = sociopath
        }
        
        # Railroading
        modifier = {
            factor = 0.0
            
            trait = content
            NOR = {
                trait = elusive_shadow
                trait = intricate_webweaver
                trait = brilliant_strategist
                trait = skilled_tactician
                trait = tough_soldier
                trait = misguided_warrior
                trait = ambitious
                trait = sociopath
                trait = greedy
            }
        }
    }
}