
# Our first casus belli allows conquest of individual counties from neighbouring equal-tier rulers.
# Our second casus belli allows conquest of duchies from neighbouring equal tier rulers, but at greater cost.

# Currently you can only use the casus belli against other religions, ie seven against old gods.

# ROOT is the attacker
# FROM is the target

tsk_county_conquest = {
    name = CB_NAME_TSK_COUNTY_CONQUEST
    war_name = WAR_NAME_TSK_COUNTY_CONQUEST
    
    sprite = 16
    truce_days = 1825
    hostile_against_others = yes
    is_permanent = yes
    check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
    press_claim = yes
    can_ask_to_join_war = no
    
    allowed_to_target_tributaries = no
    allowed_to_target_suzerains = no
    
    # You require 150 prestige to use
    can_use_gui = {
        ROOT = {
            NOT = {
                trait = content
            }
            prestige = 55
        }
    }
    
    on_add = {
        ROOT = { prestige = -50 }
    }
    
    can_use = {
        ROOT = {
            mercenary = no
            NOT = {
                same_realm = FROM
            }
            OR = {
                AND = {
                    primary_title = { higher_tier_than = COUNT } 
                    # AND = {
                        # religion_group = drowned_god_group
                        # culture_group = iron_islander
                    # }
                }
                AND = {
                    primary_title = { higher_tier_than = DUKE }
                    # NOT = {
                        # religion = FROM
                    # }
                }
            }
        }
    }

    can_use_title = {
        tier = COUNT
        
        # if:
        # Our target is a player (ai = no)
        # the location is the capital (is_capital = yes)
        # then disallow war
        
        NOR = {
            AND = {
                FROM = {
                    ai = no
                }
                location = {
                    is_capital = yes
                }
            }
            ROOT = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = ROOT
            }
        }
        
        # Our target holds the county
        # or they have a vassal that holds it
        
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
                NOT = {
                    same_realm = ROOT
                }
                # OR = {
                    # AND = {
                        # ROOT = {
                            # religion_group = drowned_god_group
                            # culture_group = iron_islander
                        # }
                    # }
                    # NOT = { 
                        # religion = ROOT
                    # }
                # }
            }
        }

        # Drowned gods may target who they wish
        # so long as the target is coastal
        
        # If it is not a specific title or ironborn,
        # then
        # target province/s must border the target realm
        
        OR = {
            AND = {
                ROOT = {
                    religion_group = drowned_god_group
                    culture_group = iron_islander
                }
                location = {
                    port = yes
                }
            }
            # Some islands literally cannot do anything, so they are being granted the ability to take ports
            # only applicable if it is your primary title.
            AND = {
                ROOT = {
                    primary_title = {
                        OR = {
                            title = e_the_iron_islands
                            title = k_the_iron_islands
                            title = k_the_shields
                            title = k_evenstar
                            title = k_the_arbor
                            title = k_the_sisters
                            title = k_fair_isle
                            title = k_the_stepstones
                            title = k_andalos
                            title = k_stone
                            title = k_dragonstone
                            title = d_dragonstone
                            title = c_dragonstone
                            title = c_driftmark
                        }
                    }
                }
                location = {
                    port = yes
                }
            }
            location = {
                any_neighbor_province = {
                    owner = {
                        OR = {
                            character = ROOT
                            is_liege_or_above = ROOT
                        }
                    }
                }
            }
        }
    }

    is_valid_title = {
        OR = {
            # If we are both drowned_god and an iron islander culture group, we can freely wage war
            ROOT = {
                religion_group = drowned_god_group
                culture_group = iron_islander
                NOT = {
                    same_realm = FROM
                }
            }
            
            # Otherwise you cannot declare against the same religion
            ROOT = {
                NOT = {
                    same_realm = FROM
                    # religion = FROM
                }
            }
        }
    
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
            }
        }
    }

    on_success_title = {
        usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
        
        any_de_jure_vassal_title = { # take all baronies too
            limit = {
                has_holder = yes
                holder_scope = {
                    OR = {
                        character = FROM
                        is_liege_or_above = FROM
                        AND = {
                            is_liege_or_above = ROOT
                            NOT = { culture = ROOT }
                            NOT = { religion = ROOT }
                        }
                    }
                }
            }

            usurp_title = ROOT
        }
    }

    on_fail_title = {
        ROOT = {
            prestige = -200
        }
    
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 50 }
        }
    }

    on_reverse_demand = {
        ROOT = {
            prestige = -200
            transfer_scaled_wealth = {
                to = FROM
                value = 2.0
            }
        }
        
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 100
            participation_scaled_piety = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = {
                participation_scaled_prestige = 100 
                participation_scaled_piety = 50
            }
        }
    }

    attacker_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    defender_ai_defeat_worth = {
        factor = 100
    }
    ai_will_do = { 
        factor = 0 # AI WILL NOT USE
        
        modifier = {
            factor = 0.0
        }
    }
}

# Now subjugates duchies rather than conquers
tsk_duchy_conquest = {
    name = CB_NAME_TSK_DUCHY_CONQUEST
    war_name = WAR_NAME_TSK_DUCHY_CONQUEST
    sprite = 16
    truce_days = 1825
    is_permanent = yes
    
    hostile_against_others = yes
    
    check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
    press_claim = yes
    can_ask_to_join_war = no
    
    allowed_to_target_tributaries = no
    allowed_to_target_suzerains = no
    
    infamy_modifier = 1.5
    
    # You require 700 prestige to use
    can_use_gui = {
        ROOT = {
            NOT = {
                trait = content
            }
            prestige = 255
        }
    }
    
    on_add = {
        ROOT = { prestige = -250 }
    }
    
    can_use = {
        ROOT = {
            mercenary = no
            OR = {
                # AND = {
                    # primary_title = { higher_tier_than = DUKE } 
                    # OR = {
                        # religion_group = drowned_god_group
                        # culture_group = iron_islander
                    # }
                # }
                AND = {
                    primary_title = { higher_tier_than = DUKE }
                    NOR = {
                        same_realm = FROM
                        # religion = FROM
                    }
                }
            }
        }
    }

    can_use_title = {
        tier = DUKE
        
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
                OR = {
                    # ROOT = {
                        # OR = {
                            # religion_group = drowned_god_group
                            # culture_group = iron_islander
                        # }
                    # }
                    NOR = {
                        same_realm = ROOT
                        # religion = ROOT
                    }
                }
            }
        }
        
        any_direct_de_jure_vassal_title = {
            OR = {
                holder_scope = {
                    OR = {
                        character = ROOT
                        is_liege_or_above = ROOT
                    }
                }
                location = {
                    any_neighbor_province = {
                        has_owner = yes
                        owner = {
                            OR = {
                                character = ROOT
                                is_liege_or_above = ROOT
                            }
                        }
                    }
                }
            }
        }
    }

    is_valid_title = {
        OR = {
            # If we are both drowned_god and an iron islander culture group, we can freely wage war
            # ROOT = {
                # religion_group = drowned_god_group
                # culture_group = iron_islander
                # NOT = {
                    # same_realm = FROM
                # }
            # }
            
            # Otherwise you cannot declare against the same religion
            ROOT = {
                NOR = {
                    same_realm = FROM
                    # religion = FROM
                }
            }
        }
    
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
            }
        }
    }

    on_success_title = {
        ROOT = {
            vassalize_or_take_under_title = {
                title = PREV
                enemy = FROM
                # same_religion = yes # Only vassalize rulers of my religion
                type = invasion
            }
        }
    }

    on_fail_title = {
        ROOT = {
            prestige = -200
        }
    
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 50 }
        }
    }

    on_reverse_demand = {
        ROOT = {
            prestige = -200
            transfer_scaled_wealth = {
                to = FROM
                value = 3.0
            }
        }
        
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 100
            participation_scaled_piety = 50
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = {
                participation_scaled_prestige = 100 
                participation_scaled_piety = 50
            }
        }
    }

    attacker_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    defender_ai_defeat_worth = {
        factor = 100
    }
    ai_will_do = { 
        factor = 0 # AI WILL NOT USE
        
        modifier = {
            factor = 0.0
        }
    }
}

tsk_subjugation = {
    name = CB_NAME_TSK_SUBJUGATION
    war_name = WAR_NAME_TSK_SUBJUGATION
    sprite = 8
    truce_days = 365
    hostile_against_others = yes
    is_permanent = yes
    can_ask_to_join_war = yes
    check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
    allowed_to_target_tributaries = no
    allowed_to_target_suzerains = no
    
    can_use_gui = {
        ROOT = {
            prestige = 850
            trait = ambitious
        }
    }
    
    on_add = {
        ROOT = { prestige = -800 }
    }
    
    can_use = {
        ROOT = {
            NOR = {
                same_realm = FROM
                # religion = FROM
            }
            primary_title = {
                higher_tier_than = KING
            }
            has_horde_culture = no
            is_nomadic = no
            mercenary = no
        }
    }
    
    can_use_title = {
        tier = KING
        
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
                NOT = {
                    same_realm = ROOT
                }
            }
        }
        
        NOT = {
            ROOT = {
                has_character_modifier = launched_subjugation
            }
        }

        # FROM = {
            # any_realm_title = {
                # de_jure_liege_or_above = PREVPREV
            # }
        # }
    }
    
    is_valid_title = {    
        ROOT = {
            NOT = {
                same_realm = FROM
            }
        }
        OR = {
            FROM = {
                has_landed_title = PREV
            }
            holder_scope = {
                is_liege_or_above = FROM
            }
        }
        
        # FROM = {
            # any_realm_title = {
                # de_jure_liege_or_above = PREVPREV
            # }
        # }
    }
    
    on_add_title = {
        ROOT = {
            add_character_modifier = { 
                name = launched_subjugation
                years = 5
                hidden = yes
            }
        }
    }

    on_success = {
        any_attacker = {
            limit = { character = ROOT }
            participation_scaled_prestige = 500
        }
        any_attacker = {
            limit = { NOT = { character = ROOT } }
            hidden_tooltip = { participation_scaled_prestige = 500 }
        }
        FROM = {
            prestige = -200
        }
    }
    
    on_success_title = {
        # Usurp the target kingdom itself, if the enemy holds it
        if = {
            limit = {
                holder_scope = {
                    character = FROM
                }
                NOT = { ROOT = { tier = EMPEROR } }
            }
            ROOT = { usurp_title = { target = PREV type = invasion } }
        }
        
        if = {
            # Take the enemy's duchies within the target kingdom, if we are the same or lower tier
            limit = {
                ROOT = {
                    NOT = { higher_tier_than = FROM }
                }
            }
            FROM = {
                any_demesne_title = {
                    limit = {
                        tier = DUKE
                        OR = {
                            title = PREVPREV
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    ROOT = { usurp_title = { target = PREV type = invasion } }
                }
            }
        }
        
        # Have I become the vassal of the loser due to taking a duchy or kingdom?
        if = {
            limit = {
                ROOT = {
                    is_liege_or_above = FROM    
                }
            }
            ROOT = {
                set_defacto_liege = ROOT
            }
        }
        
        # Vassalize the rest
        custom_tooltip = {
            text = pagan_subjugation_tip
            hidden_tooltip = {
                ROOT = {
                    subjugate_or_take_under_title = { # If the target only has territory within the kingdom, he is simply vassalized
                        title = PREV
                        enemy = FROM
                    }
                }
            }
        }
    }

    on_fail = {
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 200
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 200 }
        }
        ROOT = {
            prestige = -250
        }
    }
    
    on_invalidation = {
        ROOT = {
            remove_character_modifier = launched_subjugation
        }
    }

    on_reverse_demand = {
        ROOT = {
            prestige = -500
            transfer_scaled_wealth = {
                to = FROM
                value = 3.0
            }
        }
        any_defender = {
            limit = { character = FROM }
            participation_scaled_prestige = 500
        }
        any_defender = {
            limit = { NOT = { character = FROM } }
            hidden_tooltip = { participation_scaled_prestige = 200 }
        }
    }

    attacker_ai_victory_worth = {
        factor = 200
    }
    
    attacker_ai_defeat_worth = {
        factor = 100
    }

    defender_ai_victory_worth = {
        factor = -1 # always accept
    }
    
    defender_ai_defeat_worth = {
        factor = 100
    }
    
    ai_will_do = { 
        factor = 0 # AI WILL NOT USE
        
        modifier = {
            factor = 0.0
        }
    }
}